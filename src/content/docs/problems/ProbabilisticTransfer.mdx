---
title: 確率的な乗り換え
layout: ../../../layouts/Problems.astro
---

import CharacterDecorate from "./components/CharacterDecorate.astro";

## 問題文

高橋君は毎朝、電車で会社へ通勤しています。

AtCoder国には $N$ 種類の鉄道路線と $M$ 箇所の駅があり、駅同士は $E$ 本の経路で結ばれています。各辺 $i$ は駅 $A_i$ と駅 $B_i$ を結び、路線 $S_i$ に属し、乗車時間は $T_i$ 分です。

AtCoder国の住民は時間にルーズなことで有名で、すべての列車には最大 $d_{S_i}$ 分までの遅延が発生します。ただし、各列車の遅延時間は $0$ から $d_{S_i}$ 分までの整数のいずれかとなり、それらのいずれも等しい確率で発生します(つまり一様分布)。

高橋君は、自宅(駅 $1$)から会社(駅 $M$)まで、合計 $L$ 分以内に到着する必要があります。

また、高橋君は気分で乗る電車を変えるため、今いる駅から複数の隣接駅に行ける場合は、それぞれの駅に向かう経路を均等な確率で選ぶものとします。

高橋君が時間内に会社に到着できる確率を求めてください。もし、どのような遅延状況でも時間内にたどり着けない場合は、<CharacterDecorate>-1</CharacterDecorate> を出力してください。

---

## 入力形式

```text
N M E L
A1 B1 S1 T1
A2 B2 S2 T2
...
AE BE SE TE
d1 d2 ... dN
```

---

## 出力形式

- 高橋君が時間内に会社(駅 $M$)に到着できる確率を出力してください。真の値と出力との絶対誤差または相対誤差が $10^{-6}$ 以下のとき、正解と判定される。
- 到着できる経路が存在しない場合は <CharacterDecorate>-1</CharacterDecorate> を出力してください。

---

## 制約

- $1 \le S_{i} \leq N \le 1000$
- $1 \leq E \leq \frac{M(M-1)}{2}$
- $1 \leq A_{i}, B_{i} \leq M \leq 1000$
- $0 \leq L, T_i \leq 10^9$
- $0 \leq d_i \leq 10^3$

---

## 入力例1

```text
1 3 2 6
1 2 1 2
2 3 1 2
1
```

## 出力例1

```text
1.000000
```

遅延が発生しても 駅$1$ → 駅$2$ と 駅$2$ → 駅$3$ それぞれ最長 $3$ 分しかかからないので遅刻は絶対起きません。

## 入力例2

```text
1 3 2 6
1 2 1 4
2 3 1 4
1
```

## 出力例2

```text
-1
```

どの遅延が0分でも 駅$1$ → 駅$2$ と 駅$2$ → 駅$3$ それぞれ最短 $4$ 分かかるのでどうやっても間に合いません。

## 入力例3

```text
3 4 5 6
1 2 1 2
2 4 2 2
1 3 1 1
3 4 3 3
1 4 3 6
1 1 2
```

## 出力例3

```text
0.722222
```

まず、駅$1$ → 駅$2$ → 駅$4$ のルートではどう遅延しても最長$6$分なので遅刻しません。

次に、駅$1$ → 駅$3$ → 駅$4$ のルートでは$7$分かかってしまうケースがあるので、$\frac{1}{6}$の確率で遅刻してしまいます。

最後に、駅$1$ → 駅$4$ のルートですが、$7, 8$分かかるケースがあるので、$\frac{4}{6}$の確率で遅刻してしまいます。

よって、高橋くんは $1 - \frac{1}{3} \times (0 + \frac{1}{6} + \frac{4}{6}) = \frac{13}{18} \fallingdotseq 0.722222 $ の確率で遅刻せずに出勤できます。